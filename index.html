<!DOCTYPE html>
  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Combined Gear and Globe</title>
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/2.1.8/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-text-geometry-component@0.5.1/dist/aframe-text-geometry-component.min.js"></script>
	<script src='js/three.js'></script>
	<!--<script src="jsartoolkit5/artoolkit.min.js"></script>-->
	<script src="jsartoolkit5/artoolkit.api.js"></script>
	<script src="threex/threex-artoolkitsource.js"></script>
	<script src="threex/threex-artoolkitcontext.js"></script>
	<script src="threex/threex-arbasecontrols.js"></script>
	<script src="threex/threex-armarkercontrols.js"></script>
  </head>

<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>
    
    <script>
    
    var scene, camera, renderer, clock, deltaTime, totalTime;
    
    var arToolkitSource, arToolkitContext;
    
    var markerRoot1;
    
    var mesh1;
    
    initialize();
    animate();
    
    function initialize()
    {
        scene = new THREE.Scene();
    
        let ambientLight = new THREE.AmbientLight( 0xcccccc, 0.5 );
        scene.add( ambientLight );
    
        camera = new THREE.Camera();
        scene.add(camera);
    
        renderer = new THREE.WebGLRenderer({
            antialias : true,
            alpha: true
        });
        renderer.setClearColor(new THREE.Color('lightgrey'), 0)
        renderer.setSize( 640, 480 );
        renderer.domElement.style.position = 'absolute'
        renderer.domElement.style.top = '0px'
        renderer.domElement.style.left = '0px'
        document.body.appendChild( renderer.domElement );
    
        clock = new THREE.Clock();
        deltaTime = 0;
        totalTime = 0;
        
        ////////////////////////////////////////////////////////////
        // setup arToolkitSource
        ////////////////////////////////////////////////////////////
    
        arToolkitSource = new THREEx.ArToolkitSource({
            sourceType : 'webcam',
        });
    
        function onResize()
        {
            arToolkitSource.onResize()	
            arToolkitSource.copySizeTo(renderer.domElement)	
            if ( arToolkitContext.arController !== null )
            {
                arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)	
            }	
        }
    
        arToolkitSource.init(function onReady(){
            onResize()
        });
        
        // handle resize event
        window.addEventListener('resize', function(){
            onResize()
        });
        
        ////////////////////////////////////////////////////////////
        // setup arToolkitContext
        ////////////////////////////////////////////////////////////	
    
        // create atToolkitContext
        arToolkitContext = new THREEx.ArToolkitContext({
            cameraParametersUrl: 'data/camera_para.dat',
            detectionMode: 'mono'
        });
        
        // copy projection matrix to camera when initialization complete
        arToolkitContext.init( function onCompleted(){
            camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
        });
    
        ////////////////////////////////////////////////////////////
        // setup markerRoots
        ////////////////////////////////////////////////////////////
    
        // build markerControls
        markerRoot1 = new THREE.Group();
        scene.add(markerRoot1);
        let markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
            type: 'pattern', patternUrl: "data/hiro.patt",
        })
    
        let geometry1 = new THREE.SphereGeometry(1, 32,32);
        
        let loader = new THREE.TextureLoader();
        let texture = loader.load( 'images/earth-blue.jpg', render );
        let material1 = new THREE.MeshLambertMaterial( { map: texture, opacity: 0.5 } );
        
        mesh1 = new THREE.Mesh( geometry1, material1 );
        mesh1.position.y = 1;
        
        markerRoot1.add( mesh1 );
        
        let pointLight = new THREE.PointLight( 0x008080, 1, 100 );
        pointLight.position.set(0.5,3,2);
        // create a mesh to help visualize the position of the light
        pointLight.add( 
            new THREE.Mesh( 
                new THREE.SphereBufferGeometry( 0.05, 16,8 ), 
                new THREE.MeshBasicMaterial({ color: 0xffffff, opacity: 0.5 }) 
            ) 
        );
        markerRoot1.add( pointLight );
    }
    
    
    function update()
    {
        if ( markerRoot1.visible )
            mesh1.rotation.y += 0.01;
        // update artoolkit on every frame
        if ( arToolkitSource.ready !== false )
            arToolkitContext.update( arToolkitSource.domElement );
    }
    
    
    function render()
    {
        renderer.render( scene, camera );
    }
    
    
    function animate()
    {
        requestAnimationFrame(animate);
        deltaTime = clock.getDelta();
        totalTime += deltaTime;
        update();
        render();
    }
    
    </script>
    <h1>Hello!!! Please allow camera acess!</h1>>
    <a-scene embedded arjs>
      <a-marker preset= "hiro">
<!--start of gear one-->
          <a-cylinder position="0.0 0.0 0.0" radius="0.3" height="0.12" material="side: double; color: #FFC65D; transparent: true; opacity: 0.0"></a-cylinder>
          <a-cylinder position="0.0 0.0 0.0" radius="0.46" height="0.12" material="side: double; color: #FFC65D; transparent: true; opacity: 1.0"></a-cylinder>
          
          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="-0.5 0 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0.5 0 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0 0 0.5"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0 0 -0.5"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0.433 0 0.25" rotation="0 60 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.1" color="#FFC65D" position="-0.433 0 0.25" rotation="0 30 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0.433 0 -0.25" rotation="0 30 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="-0.433 0 -0.25" rotation="0 60 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0.25 0 0.433" rotation="0 30 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="-0.25 0 0.433" rotation="0 60 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="0.25 0 -0.433" rotation="0 60 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>

          <a-entity position="0.0 0.0 0.0">
            <a-box width="0.12" height="0.12" depth="0.12" color="#FFC65D" position="-0.25 0 -0.433" rotation="0 30 0"></a-box>
            <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
          </a-entity>
<!--end of gear one-->
<!--start of gear two-->
<a-cylinder position="0.0 0.18 0.0" radius="0.15" height="0.12" material="side: double; color: red; transparent: true; opacity: 0.0"></a-cylinder>
<a-cylinder position="0.0 0.18 0.0" radius="0.23" height="0.12" material="side: double; color: red; transparent: true; opacity: 1.0"></a-cylinder>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="-0.09565 0 0.2309" rotation="0 67.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="0.09565 0 0.2309" rotation="0 22.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="0.09565 0 -0.2309" rotation="0 67.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="-0.09565 0 -0.2309" rotation="0 22.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="-0.2309 0 0.09565" rotation="0 22.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="0.2309 0 -0.09565" rotation="0 22.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="0.2309 0 0.09565" rotation="0 67.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.18 0.0">
<a-box width="0.08" height="0.08" depth="0.08" color="red" position="-0.2309 0 -0.09565" rotation="0 67.5 0"></a-box>
<a-animation attribute="rotation" dur="4000" fill="forwards" to="0 -360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>
<!--end of gear two-->
<!--start of gear three-->
<a-cylinder position="0.0 0.36 0.0" radius="0.07" height="0.12" material="side: double; color: blue; transparent: true; opacity: 0.0"></a-cylinder>
<a-cylinder position="0.0 0.36 0.0" radius="0.11" height="0.12" material="side: double; color: blue; transparent: true; opacity: 1.0"></a-cylinder>

<a-entity position="0.0 0.36 0.0">
  <a-box width="0.06" height="0.06" depth="0.06" color="blue" position="-0.125 0 0"></a-box>
  <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.36 0.0">
  <a-box width="0.06" height="0.06" depth="0.06" color="blue" position="0.125 0 0"></a-box>
  <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.36 0.0">
  <a-box width="0.06" height="0.06" depth="0.06" color="blue" position="0.03125 0 0.10825" rotation="0 30 0"></a-box>
  <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.36 0.0">
  <a-box width="0.06" height="0.06" depth="0.06" color="blue" position="-0.03125 0 0.10825" rotation="0 60 0"></a-box>
  <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.36 0.0">
  <a-box width="0.06" height="0.06" depth="0.06" color="blue" position="0.03125 0 -0.10825" rotation="0 60 0"></a-box>
  <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>

<a-entity position="0.0 0.36 0.0">
  <a-box width="0.06" height="0.06" depth="0.06" color="blue" position="-0.03125 0 -0.10825" rotation="0 30 0"></a-box>
  <a-animation attribute="rotation" dur="4000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation>
</a-entity>
<!--end of gear three-->
<!--
<a-light intensity="3" color="#00ffff" position="-5.72 6.65 0.80" animation__color="property:color; dir:alternate; dur:2000; easing:easeInOutSine; loop:true; to:#ff0000" alongpath="path:10,10,-10 -20,10,-10 10,0,-10; closed:true; dur:12000"></a-light>
<a-light intensity="5" color="#ff0000" position="8.60 6.65 0.80" animation__color="property:color; dir:alternate; dur:2000; easing:easeInOutSine; loop:true; to:#0000ff" alongpath="path:-2,-2,5 2,-1,5 0,-1,5; closed:true; dur:3000;"></a-light>  
--></a-marker>
        <a-camera position='0 0 0' user-height='0'></a-camera>
      </a-scene>
  </body>
</html>